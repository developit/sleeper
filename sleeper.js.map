{"version":3,"sources":["src/sleeper.js"],"names":[],"mappings":"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","file":"sleeper.js","sourcesContent":["import jan from 'jan';\n\nconst HOP = Object.prototype.hasOwnProperty;\n\n// let extend = (obj, props) => (Object.keys(props).forEach(k=>obj[k]=props[k]), obj);\nlet extend = (obj, props) => {\n\tfor (let i in props) if (HOP.call(props, i)) obj[i] = props[i];\n\treturn obj;\n};\n\n\nclass Emitter {\n\tconstructor() {\n\t\tthis._evt={};\n\t}\n\ton(type, fn) {\n\t\t(this._evt[type] || (this._evt[type]=[])).push(fn);\n\t}\n\tremoveListener(type, fn) {\n\t\tlet e = this._evt[type],\n\t\t\ti = e && e.indexOf(fn);\n\t\tif (e && i) e.splice(i, 1);\n\t}\n\temit(type, ...args) {\n\t\tlet e = this._evt[type];\n\t\tif (e) e.slice().forEach(f=>f(...args));\n\t}\n}\n\n\n/**\tCreate a new sleeper Resource, representing one resource type exposed by a RESTful API.\n *\t@param {String} [url=/]\t\tThe full base URL for the resource (Example: http://a.com/api/users/)\n *\t@returns {sleeper.Resource} resource\n */\nlet sleeper = url => new Resource(url);\n\n\n/**\tRepresents a single resource type exposed by a RESTful API.\n *\t@constructor Create a representation of a given REST resource.\n *\t@augments puredom.EventEmitter\n *\t@param {String} [url=/]\t\tThe full base URL for the resource (Example: http://a.com/api/users/)\n */\nclass Resource extends Emitter {\n\tconstructor(url) {\n\t\tsuper();\n\t\tthis.url = url || this.url;\n\t\tthis.query = extend({}, this.query);\n\t\tthis.headers = extend({}, this.headers);\n\t}\n\n\t/**\tGet or set global parameters, sent with each request.\n\t *\t@param {String} key\n\t *\t@param {String} value\n\t */\n\tparam(key, value=undefined) {\n\t\tif (typeof key==='string') {\n\t\t\tif (value===undefined) return this.query[key];\n\t\t\tthis.query[key] = value;\n\t\t\tif (value===false) delete this.query[key];\n\t\t}\n\t\tif (typeof key==='object') extend(this.query, key);\n\t\treturn this;\n\t}\n\n\t/**\tGet or set global headers, sent with each request.\n\t *\t@param {String} header\n\t *\t@param {String} value\n\t */\n\theader(header, value=undefined) {\n\t\tif (typeof header==='string') {\n\t\t\tlet key = header.toLowerCase();\n\t\t\tif (value===undefined) return this.headers[key];\n\t\t\tthis.headers[key] = value;\n\t\t\tif (value===false) delete this.headers[key];\n\t\t}\n\t\tif (typeof header==='object') {\n\t\t\tfor (let i in header) if (HOP.call(header, i)) {\n\t\t\t\tthis.header(i, header[i]);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tindex(callback, options) {\n\t\treturn this._call('GET /', null, callback, options);\n\t}\n\n\tget(id, callback, options) {\n\t\treturn this._call('GET /' + id, null, callback, options);\n\t}\n\n\tpost(obj, callback, options) {\n\t\treturn this._call('POST /', obj, callback, options);\n\t}\n\n\tput(id, obj, callback, options) {\n\t\tif (id && typeof id==='object' && typeof obj==='function') {\n\t\t\tcallback = obj;\n\t\t\tobj = id;\n\t\t\tid = obj[this.idKey];\n\t\t}\n\t\treturn this._call('PUT /' + id, obj, callback, options);\n\t}\n\n\tpatch(id, obj, callback, options) {\n\t\treturn this.put(id, obj, callback, extend({ method:'PATCH' }, options || {}));\n\t}\n\n\tdel(id, callback, options) {\n\t\treturn this._call('DELETE /' + id, null, callback, options);\n\t}\n\n\tserializeBody(body, req) {\n\t\tif (!req.headers['content-type']) {\n\t\t\treq.headers['content-type'] = 'application/json';\n\t\t}\n\t\treturn JSON.stringify(body);\n\t}\n\n\t_call(url, body, callback, options={}) {\n\t\tlet parts = url.split(' ');\n\t\tlet method = (options.method || (parts[0]===parts[0].toUpperCase() && parts.splice(0, 1)[0]) || 'GET').toUpperCase();\n\n\t\turl = parts.join(' ');\n\t\turl = ('/' + url.replace(/(^\\/+|\\/+$)/g, '')).replace(/\\/+$/g,'');\n\n\t\tlet req = {\n\t\t\tmethod,\n\t\t\turl,\n\t\t\tpath: url,\n\t\t\tquery: extend(extend({}, this.query), options.query || {}),\n\t\t\tfullUrl : url,\n\t\t\trelativeUrl: url,\n\t\t\theaders: extend({}, this.headers),\n\t\t\tbody,\n\t\t\trawBody : body\n\t\t};\n\t\treq.request = req;\n\n\t\tlet h = options.headers;\n\t\tif (h) for (let i in h) if (HOP.call(h, i)) {\n\t\t\treq.headers[key.toLowerCase()] = h[key];\n\t\t}\n\n\t\tfor (let i in req.query) if (HOP.call(req.query, i)) {\n\t\t\treq.url += (url.indexOf('?')<0?'?':'&') + encodeURIComponent(i) + '=' + encodeURIComponent(req.query[i]);\n\t\t}\n\n\t\treq.fullUrl = req.relativeUrl = req.url;\n\t\treq.url = this.url.replace(/(?:^([a-z]+\\:\\/\\/)|(\\/)\\/+|\\/+$)/g, '$1$2') + req.url;\n\n\t\tif (options.responseType) {\n\t\t\treq.responseType = options.responseType;\n\t\t}\n\n\t\tif (req.body && typeof this.serializeBody==='function' && options.serialize!==false) {\n\t\t\treq.bodySerialized = req.body = this.serializeBody(req.body, req) || req.body;\n\t\t}\n\n\t\tthis.emit('req', req);\n\t\tthis.emit(`req:${req.relativeUrl}`, req);\n\n\t\tjan(req, (err, res, data) => {\n\t\t\treq.response = res;\n\t\t\tres.response = res.data;\n\t\t\tif (!res.status) err = res.error = 'Connection Error';\n\n\t\t\tlet r = err ? 'error' : 'success';\n\t\t\t([\n\t\t\t\t'status',\n\t\t\t\t`status:${res.status}`,\n\t\t\t\t'res',\n\t\t\t\t`res:${req.relativeUrl}`,\n\t\t\t\tr,\n\t\t\t\t`${r}:${req.relativeUrl}`\n\t\t\t]).forEach( type => this.emit(type, req, res) );\n\n\t\t\tif (typeof callback==='function') {\n\t\t\t\tcallback(res.error, res.response, res);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n}\n\nlet proto = Resource.prototype;\n\nextend(proto, {\n\t// The resource base URL\n\turl: '/',\n\t// Global querystring parameters\n\tquery: {},\n\t// Global headers\n\theaders: {},\n\t// Used to grab the identifier if you pass an object directly to put()\n\tidKey: 'id',\n\n\tcreate: proto.post,\n\tread: proto.get,\n\tupdate: proto.put,\n\tremove: proto.del\n});\n\ntry { proto['delete'] = proto.del; } catch(err) {}\n\n\nsleeper.sleeper = sleeper.Resource = Resource;\nexport default sleeper;\n"]}