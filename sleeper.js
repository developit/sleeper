(function(global,factory){if(typeof define === 'function' && define.amd){define('sleeper',['exports','module','jan'],factory);}else if(typeof exports !== 'undefined' && typeof module !== 'undefined'){factory(exports,module,require('jan'));}else {var mod={exports:{}};factory(mod.exports,mod,global.jan);global.sleeper = mod.exports;}})(this,function(exports,module,_jan){'use strict';function _interopRequireDefault(obj){return obj && obj.__esModule?obj:{'default':obj};}function _inherits(subClass,superClass){if(typeof superClass !== 'function' && superClass !== null){throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass);}subClass.prototype = Object.create(superClass && superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__ = superClass;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}var _jan2=_interopRequireDefault(_jan);var HOP=Object.prototype.hasOwnProperty;var extend=function extend(obj,props){for(var i in props) {if(HOP.call(props,i))obj[i] = props[i];}return obj;};var Emitter=(function(){function Emitter(){_classCallCheck(this,Emitter);this._evt = {};}Emitter.prototype.on = function on(type,fn){(this._evt[type] || (this._evt[type] = [])).push(fn);};Emitter.prototype.removeListener = function removeListener(type,fn){var e=this._evt[type],i=e && e.indexOf(fn);if(e && i)e.splice(i,1);};Emitter.prototype.emit = function emit(type){for(var _len=arguments.length,args=Array(_len > 1?_len - 1:0),_key=1;_key < _len;_key++) {args[_key - 1] = arguments[_key];}var e=this._evt[type];if(e)e.slice().forEach(function(f){return f.apply(undefined,args);});};return Emitter;})();var sleeper=function sleeper(url){return new Resource(url);};var Resource=(function(_Emitter){_inherits(Resource,_Emitter);function Resource(url){_classCallCheck(this,Resource);_Emitter.call(this);this.url = url || this.url;this.query = extend({},this.query);this.headers = extend({},this.headers);}Resource.prototype.param = function param(key){var value=arguments.length <= 1 || arguments[1] === undefined?undefined:arguments[1];if(typeof key === 'string'){if(value === undefined)return this.query[key];this.query[key] = value;}if(typeof key === 'object')extend(this.query,key);return this;};Resource.prototype.header = function header(_header){var value=arguments.length <= 1 || arguments[1] === undefined?undefined:arguments[1];if(typeof _header === 'string'){if(value === undefined)return this.headers[key];this.headers[_header.toLowerCase()] = value;}if(typeof _header === 'object'){for(var i in _header) {if(HOP.call(_header,i)){this.header(i,_header[i]);}}}return this;};Resource.prototype.index = function index(callback,options){return this._call('GET /',null,callback,options);};Resource.prototype.get = function get(id,callback,options){return this._call('GET /' + id,null,callback,options);};Resource.prototype.post = function post(obj,callback,options){return this._call('POST /',obj,callback,options);};Resource.prototype.put = function put(id,obj,callback,options){if(id && typeof id === 'object' && typeof obj === 'function'){callback = obj;obj = id;id = obj[this.idKey];}return this._call('PUT /' + id,obj,callback,options);};Resource.prototype.patch = function patch(id,obj,callback,options){return this.put(id,obj,callback,extend({method:'PATCH'},options || {}));};Resource.prototype.del = function del(id,callback,options){return this._call('DELETE /' + id,null,callback,options);};Resource.prototype.serializeBody = function serializeBody(body,req){if(!req.headers['content-type']){req.headers['content-type'] = 'application/json';}return JSON.stringify(body);};Resource.prototype._call = function _call(url,body,callback){var _this=this;var options=arguments.length <= 3 || arguments[3] === undefined?{}:arguments[3];var parts=url.split(' ');var method=(options.method || parts[0] === parts[0].toUpperCase() && parts.splice(0,1)[0] || 'GET').toUpperCase();url = parts.join(' ');url = ('/' + url.replace(/(^\/+|\/+$)/g,'')).replace(/\/+$/g,'');var req={method:method,url:url,path:url,query:extend(extend({},this.query),options.query || {}),fullUrl:url,relativeUrl:url,headers:extend({},this.headers),body:body,rawBody:body};req.request = req;var h=options.headers;if(h)for(var i in h) {if(HOP.call(h,i)){req.headers[key.toLowerCase()] = h[key];}}for(var i in req.query) {if(HOP.call(req.query,i)){req.url += (url.indexOf('?') < 0?'?':'&') + encodeURIComponent(i) + '=' + encodeURIComponent(req.query[i]);}}req.fullUrl = req.relativeUrl = req.url;req.url = this.url.replace(/(?:^([a-z]+\:\/\/)|(\/)\/+|\/+$)/g,'$1$2') + req.url;if(options.responseType){req.responseType = options.responseType;}if(req.body && typeof this.serializeBody === 'function' && options.serialize !== false){req.bodySerialized = req.body = this.serializeBody(req.body,req) || req.body;}this.emit('req',req);this.emit('req:' + req.relativeUrl,req);_jan2['default'](req,function(err,res,data){req.response = res;res.response = res.data;if(!res.status)err = res.error = 'Connection Error';var r=err?'error':'success';['status','status:' + res.status,'res','res:' + req.relativeUrl,r,r + ':' + req.relativeUrl].forEach(function(type){return _this.emit(type,req,res);});if(typeof callback === 'function'){callback(res.error,res.response,res);}});return this;};return Resource;})(Emitter);var proto=Resource.prototype;extend(proto,{url:'/',query:{},headers:{},idKey:'id',create:proto.post,read:proto.get,update:proto.put,remove:proto.del});try{proto['delete'] = proto.del;}catch(err) {}sleeper.sleeper = sleeper.Resource = Resource;module.exports = sleeper;});
//# sourceMappingURL=sleeper.js.map