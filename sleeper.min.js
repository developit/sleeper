/*! sleeper 0.1.0 */
!function(a,b){"function"==typeof define&&define.amd?define(["events","util","jan"],b):"object"==typeof module&&module.exports?module.exports=b(require("events"),require("util"),require("jan")):a.sleeper=b(a.events,a.util||a._,a.jan)}(this,function(a,b,c){function d(a){return new d.Resource(a)}var e=a.EventEmitter||a;d.Resource=function(a){e.call(this),this.url=a||this.url,this.query=b.extend({},this.query),this.headers=b.extend({},this.headers)},b.inherits(d.Resource,e);var f=d.Resource.prototype;b.extend(f,{url:"/",query:{},headers:{},param:function(a,c){if("string"==typeof a){if(1===arguments.length)return this.query[a];this.query[a]=c}return"object"==typeof a&&b.extend(this.query,a),this},header:function(a,b){var c;if("string"==typeof a){if(1===arguments.length)return this.headers[key];this.headers[a.toLowerCase()]=b}if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&this.header(c,a[c]);return this},index:function(a,b){return this._call("GET /",null,a,b)},get:function(a,b,c){return this._call("GET /"+a,null,b,c)},post:function(a,b,c){return this._call("POST /",a,b,c)},put:function(a,b,c,d){return a&&"object"==typeof a&&"function"==typeof b&&(c=b,b=a,a=b[this.idKey]),this._call("PUT /"+a,b,c,d)},patch:function(a,c,d,e){return this.put(a,c,d,b.extend({method:"PATCH"},e||{}))},del:function(a,b,c){return this._call("DELETE /"+a,null,b,c)},idKey:"id",serializeBody:function(a,b){return b.headers["content-type"]||(b.headers["content-type"]="application/json"),JSON.stringify(a)},_call:function(a,d,e,f){var g,h,i,j,k=this,l=b.extend({},this.headers),m=b.extend({},this.query),n=a.split(" ");f=f||{},f.headers&&b.forEach(f.headers,function(a,b){l[b.toLowerCase()]=a}),f.query&&b.extend(m,f.query),n[0]===n[0].toUpperCase()&&(g=String(f.method||n.splice(0,1)[0]||"GET").toUpperCase()),a=n.join(" "),a=("/"+a.replace(/(^\/+|\/+$)/g,"")).replace(/\/+$/g,""),h=a,m&&b.forEach(m,function(b,c){a+=(a.indexOf("?")<0?"?":"&")+encodeURIComponent(c)+"="+encodeURIComponent(b)}),i=a,a=this.url.replace(/(?:^([a-z]+\:\/\/)|(\/)\/+|\/+$)/g,"$1$2")+a;var o={path:h,querystring:j,query:m,url:a,fullUrl:a,relativeUrl:i,method:g,headers:l,body:d,rawBody:d};return f.responseType&&(o.responseType=f.responseType),o.body&&"function"==typeof this.serializeBody&&f.serialize!==!1&&(o.bodySerialized=o.body=this.serializeBody(d,o)||o.body),this.emit("req",o),this.emit("req:"+i,o),c(o,function(a,b){{var c,d,f;k.errorMessageProp||k.messageProp,a||!b.status||b.status>=400}for(b.response=b.data,b.status||(a=b.error="Connection Error"),f=a?"error":"success",c=["status","status:"+b.status,"res","res:"+i,f,f+":"+i],d=0;d<c.length;d++)k.emit(c[d],[o,b]);"function"==typeof e&&e(b.error,b.response,b)}),this}}),f.create=f.post,f.read=f.get,f.update=f.put,f.remove=f.del;try{f["delete"]=f.del}catch(g){}return d.rest=d.sleeper=d,d});